自动化测试
===============================
**Note:**为了解放我们的测试人员，避免他们过多的重复劳动；为了规避测试中，测试人员自身带来的对于测试的一些风险
故我们选择用自动化测试这种测试手法来提高我们软件的质量。

# 建立模型
* 自动化测试就是要模拟真实的测试环境，真实测试环境中，有这样几个必不可少的对象：

      1. 测试人员

      2. 测试软件

      3. 外部端口信号（EMU或者真实机床端口）
	（当然了，在未来，除了端口还可能会有其他的外部信息输入到软件中，不过暂时我们先不考虑。）

* 接着，分析这些对象的任务
      1. 人：人主要是对软件进行各种各样的操作。也就是说软件上所有可以和用户交互的地方，我们通过脚本都要可以模拟
             出来，不然自动化测试就是不完整的。(现在有一些部分是无法模拟的，比如是F菜单)
             
      2. 软件： 我们的仿真软件要与实际中用的软件一致，不能有任何的差别。
      
      3. 外部信息（端口）：这些端口都要可以模拟输入和输出，并且他们的各种触发条件都要可以模拟，比如说位置条件，时间条件。
      
* 实现以上分析出的对象，同时这些对象的能力都要具备

1. 用一些具有逻辑的脚本来模拟了人的行为，进行测试操作

2. 用一个定时器来定时检测，实现现实中对各种触发条件的模拟

3. 在软件运行的时候，我们传递两个参数给真实的软件，将上面实现的模拟人行为的脚本和一个定时器脚本传递给软件，模拟测试。

#行为脚本

这些行为脚本模拟的就是人去完成测试用例所需要的操作，比如说：

* 执行某个子程序，Phoenix.G.Channels[0].Code = "...";Phoenix.G.Channnels[0].Start = true
 
* 切换模式  Phoenix.G.Channels[0].Mode = "..."

同时要注意的是，我们在执行操作的时候要注意现实环境中的一些限制条件，比如等待。一个操作完之后我们都需要等待到一定的条件再执行下
一个指令，所以要等待并检测条件，我们利用循环来做这个事情
```
repeat
    Sleep(100)
until Phoenix.G.Channels[0].Status == "Idle"
```
另外，在检测端口的时候要注意软件的状态，将一个端口修改之后，并不是马上就可以进行检测的，因为测试脚本的执行速度有可能会快于端口的
变化情况，所以在检测条件的时候要等待一定的时间。
```
Phoenix.G.Lambda.X01_Emulated = false (假设这个端口是导致报警的唯一端口)

Sleep(100)

if Phoenix.G.Channels[0].Status == "Estop" then
      Msg("端口解除失败")
end
``` 
*总结：*总结一下，要写好行为脚本，要做几件事情

1. 了解软件各个模块的接口，灵活使用他们

2. 了解软件的一些细节问题，比如时序问题等

3. 注意拟人环境下，人的细节行为。

这里，对接口的掌握可以在软件根目录下运行`Phoenix.Data.bat`程序来生成树状接口表，通过`Phoenix.Data.View.exe`来查看
#定时器脚本

目前的定时器脚本是Circle.lua，但这个并不是唯一的，取决于给Ncstudio.exe传参数的时候传的是一个什么样的参数。
定时器脚本中是这样的：
```
function Position()
	if Phoenix.G.Channels[0].Axes[0].MachCoor >= 100 then 
	Phoenix.G.Lambda.X01_Emulated = true
	else
		Phoenix.G.Lambda.X01_Emulated = nil
	end 
end 

function OnTimer()
	Position()	
end
```
function OnTimer()函数是定时器函数，自动检测时会执行这个函数
function Position()是我们自己写的函数，用来检测位置信息给某个端口产生变化的函数。这个函数如果不放入定时器函数中，那他就不会有作用。

#自动化测试开始
自动化测试是在执行ncstudio.exe的时候给他传递两个参数就可以了，同时，这些参数都是可有可无的。

我们现在的实现是这样的`ncstudio.exe -t:Test_Auto.lua -c:circle.lua`

-t:传递的是行为脚本

-c:传递的是定时器脚本

#脚本的自动调用
完成上面的工作，我们就完成了一个完整的自动化测试。但是如何执行一系列的自动化测试，我们用批处理文件来进行这个操作，因为批处理文件有专门的
教程，我在这里就不作赘述了。

